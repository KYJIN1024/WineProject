<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">

<head>
	
	    <meta charset="utf-8">
	    <title>Kowasa-한국와인 정보 커뮤니티 사이트</title>
	    <meta content="width=device-width, initial-scale=1.0" name="viewport">
	    <meta content="" name="keywords">
	    <meta content="" name="description">
	
	    <!-- Favicon -->
	    <link href="img/favicon.ico" rel="icon">
	
	    <!-- Google Web Fonts -->
	    <link rel="preconnect" href="https://fonts.googleapis.com">
	    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@600;700&family=Ubuntu:wght@400;500&display=swap" rel="stylesheet"> 
	
	    <!-- Icon Font Stylesheet -->
	    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
	
	    <!-- Libraries Stylesheet -->
	    <link href="/lib/animate/animate.min.css" rel="stylesheet">
	    <link href="/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
	    <link href="/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
	
	    <!-- Customized Bootstrap Stylesheet -->
	    <link href="/css/bootstrap.min.css" rel="stylesheet">
	    
	     <!-- Template Stylesheet -->
	    <link href="/css/style.css" rel="stylesheet">
	    
	    <!-- Template Stylesheet -->
	    <link href="/css/communitystyle.css" rel="stylesheet">
	   
	    
	    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet">
	    
	    	<style>
		    .content-container img {
		        max-width: 100%; /* 이미지의 최대 너비를 컨테이너 너비로 제한 */
		        height: auto; /* 높이는 자동으로 조정 */
		    }
		    
		    .sidebar-content {
			    overflow-y: auto;  /* 수직 스크롤바 설정 */
			    max-height: 600px;  /* 적절한 높이 값 설정 */
			    padding: 15px;
			}
		    
		    .content-section {
			    padding: 15px;  /* 15픽셀의 여백을 모든 방향에 추가합니다 */
			}
			
			
 			.action-buttons a {
			      margin-right: 10px;
			      padding: 5px 15px;
			      border: 1px solid #007bff;
			      color: #007bff;
			      border-radius: 5px;
			      transition: all 0.3s;
		   }
		   
		   .action-buttons a:hover {
			      background-color: #007bff;
			      color: #fff;
			      text-decoration: none;
		   }
		   
			.content-section img {
	        max-width: 100%; /* 이미지 최대 너비를 컨테이너 너비로 제한 */
	        max-height: 800px; /* 이미지의 최대 높이를 500px로 제한 */
	        width: auto; /* 너비를 자동으로 설정하여 비율 유지 */
	        height: auto; /* 높이를 자동으로 설정하여 비율 유지 */
	        display: block; /* 블록으로 이미지 표시 */
	        margin: 0 auto; /* 중앙 정렬 */
	    }
	    
	    /* 사이드바를 우측으로 조정하고 content-section 너비를 늘림 */
	    @media (min-width: 992px) { /* 대형 화면을 위한 조정 */
	        .row {
	            display: flex;
	            flex-wrap: wrap;
	            margin-right: -15px; /* row의 음수 마진을 사용하여 컨테이너 밖으로 넘치는 문제를 해결 */
	            margin-left: -15px;
	        }
	        .col-lg-8 {
	            flex: 0 0 90%; /* content-section의 너비를 70%로 설정 */
	            max-width: 70%;
	        }
	        .col-lg-4 {
	            flex: 0 0 30%; /* 사이드바의 너비를 30%로 설정 */
	            max-width: 30%;
	            margin-left: auto; /* 사이드바를 오른쪽으로 이동 */
	        }
	    }
		</style> 
</head>
    
 <body>
	    <!-- Navbar Start -->
	    <nav class="navbar navbar-expand-lg bg-white navbar-light shadow sticky-top p-0">
	        <a href="/" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
	            <h2 class="m-0 text-primary" style="font-family: 'Nanum Gothic', sans-serif;">
		  <img src="/img/winelogo.jpg" alt="Image" width="50" height="50">
		  KOWASA &nbsp;&nbsp; <h5>한국와인 정보 커뮤니티</h5>
		</h2>
	        </a>
	        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
	            <span class="navbar-toggler-icon"></span>
	        </button>
	        <div class="collapse navbar-collapse" id="navbarCollapse">
	            <div class="navbar-nav ms-auto p-4 p-lg-0">
	                <a href="/" class="nav-item nav-link active">Home</a>
	                <div class="nav-item dropdown">
	                    <a href="/search" class="nav-item nav-link active">와인검색</a>
	                    
	                </div>
	                <div class="nav-item dropdown">
	                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">커뮤니티</a>
	                    <div class="dropdown-menu fade-up m-0">
	                        <a href="/community/freeboard/list" class="dropdown-item">자유게시판</a>
	                        <a href="/community/eventboard/list" class="dropdown-item">행사정보</a>
	                    </div>
	                </div>
	                <div class="nav-item dropdown">
	                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">와인파트너스</a>
	                    <div class="dropdown-menu fade-up m-0">
	                       <a href="/partners/producer/list" class="dropdown-item">생산자</a>
	                       <a href="/partners/shop/list"class="dropdown-item">샵/레스토랑 정보</a>
                      	   <a href="/partners/job/list" class="dropdown-item">구인구직</a>
	                    </div>
	                </div>
	            </div>
	           	<a href="/login" class="btn btn-primary py-4 px-lg-5 d-none d-lg-block" th:if="${#authorization.expression('isAnonymous()')}">
					    Login<i class="fa fa-arrow-right ms-3"></i>
					</a>
					<div class="btn btn-primary py-4 px-lg-5 d-none d-lg-block" th:if="${#authorization.expression('isAuthenticated()')}">
					    <p style="margin-top: 10px;"><span th:text="${#session.getAttribute('username')}"></span>님, 환영합니다.</p>
					    <button style="padding: 2px 5px;" onclick="location.href='/logout'">로그아웃</button>
					    <button style="padding: 2px 5px;" onclick="location.href='/mypage'">마이페이지</button>
					</div>
	     	   </div>
	    </nav>
	    <!-- Navbar End -->
	     <!-- Back to Top -->
	    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>	
	    
	     <!-- Page content-->
        <div class="container mt-5">
            <div class="row">
                <div class="col-lg-8">
                    <!-- Post content-->
                    <article>
                        <!-- Post header-->
                        <header class="mb-4">
                            <!-- Post title-->
                            	<h1 class="fw-bolder mb-1"> <a th:text="${freeboard.frboardtitle}"></a> </h1>
                           	<!-- 작성자 및 등록일 -->
                       			<div class="text-muted fst-italic mb-2">
                       				작성자 <a th:text="${freeboard.frboardwriter}"></a> 
                       				| 작성일 <a th:text="${freeboard.frboardcreatetime.toLocalDate()}"></a>
                       				| 조회수 <a th:text="${freeboard.frboardhits}"></a>
                       			</div>
                   		</header>
	                     <!-- 글 내용 -->
	                    <section class="mb-5">
	                        <div class="content-section" th:utext="${freeboard.frboardcontent}"></div>
	                    </section>
	                    
	                     <!-- Comments section-->
	                    <section class="mb-5">
	                        <div class="card bg-light">
	                            <div class="card-body">
	                                <!-- Comment form-->
	                                <h5>댓글 남기기</h5>
										 <form th:action="@{/community/freeboard/{frboardid}/addComment(frboardid=${freeboard.frboardid})}" method="post" th:object="${comment}">
										        <div class="form-group d-flex align-items-center">
										            <textarea class="form-control" rows="1" 
											          th:placeholder="${session.username != null ? '댓글을 입력하세요.' : '댓글을 작성하려면 로그인 해주세요.'}" 
											          th:field="*{content}" style="width: 70%;"
											          th:disabled="${session.username == null ? true : false}"></textarea>
										             <button type="submit" class="btn btn-primary">댓글 등록</button>
										        </div>
										 </form>
	                                <!-- Comment list-->
							            <ul class="list-unstyled">
							                <!-- ... [댓글 목록] ... -->
												<li th:each="comment : ${comments}" th:id="'comment-' + ${comment.id}">
												    <div class="d-flex justify-content-between">
												        <div class="ms-3">
												            <div class="fw-bold">[[${comment.writer}]]</div>
												            <div class="comment-content" th:id="'comment-content-' + ${comment.id}">
												                <small class="text-muted">[[${#temporals.format(comment.timestamp, 'yyyy-MM-dd')}]]</small>
												                <p class="mt-2 comment-text" th:data-content="${comment.content}">[[${comment.content}]]</p>
												                <!-- 편집 가능한 입력 필드 숨김 -->
												                <div class="edit-form d-none">
												                    <textarea class="form-control comment-edit-text" rows="2">[[${comment.content}]]</textarea>
												                    <button class="btn btn-success save-edit" th:data-comment-id="${comment.id}">저장</button>
												                    <button class="btn btn-secondary cancel-edit" th:data-comment-id="${comment.id}">취소</button>
												                </div>
												            </div>
												        </div>
												        <!-- Edit and Delete buttons -->
												        <div th:if="${comment.writer == session.username}">
												            <button class="edit-comment" th:data-comment-id="${comment.id}">수정</button>
												            <button class="delete-comment" th:data-comment-id="${comment.id}">삭제</button>
												        </div>
												    </div>
												</li>
							            </ul>
							        </div>
							    </div>
							</section>
	                    
	                    <!-- 글 관리 버튼 -->
	                    <div class="action-buttons">
	                        <a th:href="@{/community/freeboard/delete(id=${freeboard.frboardid})}">글 삭제</a>
	                        <a th:href="@{/community/freeboard/modify/{id}(id = ${freeboard.frboardid})}">글 수정</a>
	                        <a th:href="@{/community/freeboard/list}">목록으로</a>
	                    </div>
	                </article>
                </div>
		        <!-- Sidebar content -->
				<div class="col-lg-4">
				    <div class="bg-white mb-3">
				        <h4 class="px-3 py-4 op-5 m-0">인기게시물</h4>
				        <hr class="m-0">
				        <th:block th:each="board : ${topBoards}">
				            <div class="pos-relative px-3 py-3">
				                <h6 class="text-primary text-sm">
				                    <a th:href="@{/community/freeboard/view(id=${board.frboardid})}" th:text="${board.frboardtitle}">Post Title</a>
				                </h6>
				                <p class="mb-0 text-sm">
				                    <span th:text="${T(com.wine.demo.utils.Utility).getTimeAgo(board.frboardcreatetime)}">Posted Time</span>
				                    by <a class="text-black" th:text="${board.frboardwriter}">Author</a>
				                </p>
				            </div>
				            <hr class="m-0">
				        </th:block>
				    </div>
				</div>
		 </div>
	</div>
				
				
	  <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">주소</h4>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i>서울특별시 강남구 테헤란로1길</p>
                    <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>010-7583-7320</p>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i>kowasa@wine.com</p>
                    <div class="d-flex pt-2">
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-youtube"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">영업시간</h4>
                    <h6 class="text-light">월요일 - 금요일:</h6>
                    <p class="mb-4">오전9시 - 저녁6시</p>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">서비스</h4>
                    <a class="btn btn-link" href="">국산와인 B2B 상담</a>
                    <a class="btn btn-link" href="">판매전략</a>
                    <a class="btn btn-link" href="">전시회 일정안내 </a>
                    <a class="btn btn-link" href="">파트너스 등록</a>
               
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">와인 뉴스레터 구독</h4>
                    <p>매달 다양한 와인관련 소식을 이메일로 받아보세요!</p>
                    <div class="position-relative mx-auto" style="max-width: 400px;">
                        <input class="form-control border-0 w-100 py-3 ps-4 pe-5" type="text" placeholder="이메일주소를 입력해주세요">
                        <button type="button" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2">등록</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a class="border-bottom" href="#">Kowasa</a>, All Right Reserved.
 
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <div class="footer-menu">
                            <a href="">Home</a>
                            <a href="">Cookies</a>
                            <a href="">Help</a>
                            <a href="">FQAs</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->			

	<!-- JavaScript Libraries -->
	    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
	    <script src="/lib/wow/wow.min.js"></script>
	    <script src="/lib/easing/easing.min.js"></script>
	    <script src="/lib/waypoints/waypoints.min.js"></script>
	    <script src="/lib/counterup/counterup.min.js"></script>
	    <script src="/lib/owlcarousel/owl.carousel.min.js"></script>
	    <script src="/lib/tempusdominus/js/moment.min.js"></script>
	    <script src="/lib/tempusdominus/js/moment-timezone.min.js"></script>
	    <script src="/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
	
	    <!-- Template Javascript -->
	    <script src="/js/main.js"></script>
	    
	    <script th:inline="javascript">
			/*<![CDATA[*/
			    // AJAX를 사용하여 댓글 수정 처리
			    function updateComment(commentId) {
			        var commentContentDiv = $('#comment-content-' + commentId);
			        var editForm = commentContentDiv.find('.edit-form');
			        var currentContent = commentContentDiv.find('.comment-text').data('content');
			
			        // 기존 댓글 내용 숨김, 편집 폼 표시
			        commentContentDiv.find('.comment-text').hide();
			        editForm.removeClass('d-none');
			
			        // 편집 폼 내 텍스트에리어에 현재 내용 적용
			        editForm.find('.comment-edit-text').val(currentContent);
			
			        // 저장 버튼 이벤트 핸들러
			        editForm.find('.save-edit').off('click').on('click', function() {
			            var newContent = editForm.find('.comment-edit-text').val();
			            // AJAX 요청을 통한 댓글 업데이트
			            if (newContent && newContent !== currentContent) {
			                $.ajax({
			                    url: `/community/freeboard/comment/` + commentId + `/update`,
			                    type: 'POST',
			                    contentType: 'application/json',
			                    data: JSON.stringify({ content: newContent }),
			                    success: function(response) {
			                        // 성공 시 페이지에서 댓글 내용 업데이트
			                        commentContentDiv.find('.comment-text').text(newContent).show();
			                        editForm.addClass('d-none');
			                    },
			                    error: function(error) {
			                        console.error('Error updating comment:', error);
			                    }
			                });
			            } else {
			                commentContentDiv.find('.comment-text').show();
			                editForm.addClass('d-none');
			            }
			        });
			
			        // 취소 버튼 이벤트 핸들러
			        editForm.find('.cancel-edit').off('click').on('click', function() {
			            commentContentDiv.find('.comment-text').show();
			            editForm.addClass('d-none');
			        });
			    }
			
			    // AJAX를 사용하여 댓글 삭제 처리
			    function deleteComment(commentId) {
			        if (confirm('댓글을 삭제하시겠습니까?')) {
			            // AJAX 요청으로 서버에 데이터 전송
			            $.ajax({
			                url: `/community/freeboard/comment/` + commentId + `/delete`,
			                type: 'GET',
			                success: function(response) {
			                    // 성공 시 페이지에서 댓글 요소 제거
			                    $('#comment-' + commentId).remove();
			                },
			                error: function(error) {
			                    alert("댓글 삭제에 실패했습니다.");
			                }
			            });
			        }
			    }
			
			    // 댓글 수정 및 삭제 버튼 이벤트 바인딩
			    $(document).on('click', '.edit-comment', function() {
			        var commentId = $(this).data('commentId');
			        updateComment(commentId);
			    });
			
			    $(document).on('click', '.delete-comment', function() {
			        var commentId = $(this).data('commentId');
			        deleteComment(commentId);
			    });
			/*]]>*/
			</script>
		
</body>
</html>